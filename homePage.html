<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Chat App</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="https://images.unsplash.com/photo-1666515878427-c0a045bf03c6?crop=entropy&cs=tinysrgb&fm=jpg&ixid=MnwzMjM4NDZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2Njg3NDQ4MjM&ixlib=rb-4.0.3&q=80"
    />
    <link rel="stylesheet" type="text/css" href="/css/app.css" />
    <link rel="stylesheet" type="text/css" href="/css/md.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.3/animate.min.css"
      rel="stylesheet"
    />
    <link href="https://www.w3schools.com/w3css/4/w3.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="top nav">
      <div class="itm inactive">
        <i class="fa-duotone fa-question"></i> Question
      </div>
      <div class="itm inactive">
        <i class="fa-duotone fa-house-user"></i> Home
      </div>
      <div class="itm inactive">
        <i class="fa-duotone fa-comments"></i> Chat
      </div>
      <div class="itm inactive">
        <i class="fa-sharp fa-solid fa-magnifying-glass"></i> Information
      </div>
      <div class="itm inactive">
        <i class="fa-sharp fa-regular fa-gears"></i> Settings
      </div>
    </div>

    <main class="Question">
      <iframe id="myframe" src="/html/iframe.html"> </iframe>
    </main>

    <main class="Home">
      <div class="bar">
        <form id="home" action="/logout" method="post">
          <i class="fa-solid fa-house"></i>
          <a>Log out</a>
        </form>
        <canvas id="myCanvas" width="240" height="30">
          Your browser does not support the canvas tag.
        </canvas>
      </div>
    </main>

    <main class="Chat">
      <div id="myNav" class="overlay">
        <div class="overlay-content">
          <a href="#">Page is too small</a>
        </div>
      </div>
      <div class="bar">
        <form id="home" action="/logout" method="post">
          <i class="fa-solid fa-house"></i>
          <a>Log out</a>
        </form>

        <canvas id="myCanvas" width="240" height="30">
          Your browser does not support the canvas tag.
        </canvas>
      </div>
      <div class="flex-container">
        <div class="inputs">
          <p class="roomNameId" style="font-size: 18px">room: ?</p>
          <ul class="chat"></ul>
          <textarea
            style="overflow: auto; resize: none"
            class="messageBar"
            rows="10"
            cols="40"
          ></textarea>
          <button class="send">
            <i class="fa-sharp fa-solid fa-paper-plane-top"></i>
          </button>
        </div>
        <div class="table">
          <table id="allContentPeople"></table>
        </div>
      </div>
    </main>

    <main class="Information">
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8" />
          <title>CodePen - A Pen by malcolm</title>
          <script
            src="https://kit.fontawesome.com/fd76b8450f.js"
            crossorigin="anonymous"
          ></script>
          <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.0.10/css/all.css"
          />
          <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          />
          <link rel="stylesheet" href="/markdown/style.css" />
        </head>
        <body>
          <!-- partial:index.partial.html -->
      
          <h1>Logging in <i class="fa-solid fa-user-lock"></i></h1>
<p>On this page, the user will log in. The user must log in with both username and password. The user will be redirected to a new page if the password and username are incorrect.</p>
<p><img src="https://assets.codepen.io/5594200/Screen+Shot+2023-02-15+at+1.44.50+PM.png" alt="login"></p>
<blockquote>
<blockquote>
<p>If a user tries to log in and has no page, they will be sent a <strong>401</strong> error code.</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p><img src="https://assets.codepen.io/5594200/Screen+Shot+2023-02-16+at+6.56.47+AM.png" alt="login"></p>
</blockquote>
</blockquote>
<hr>
<h1>Signing up <i class="fa-solid fa-user-plus"></i></h1>
<p>On this page, the user will sign up. If the username is already used, the account will not be created. Users may have the same password. Passwords are not stored in the table as raw text but as a hash.</p>
<p>password hashing is done by the <i class="fa-duotone fa-face-hand-peeking"></i></p>
<pre><code class="javascript">function hide(text) {
  return new Promise(function (resolve, reject) {
    bcrypt.genSalt(10, function (err, salt) {
      bcrypt.hash(text, salt, function (err, hash) {
        if (err) return reject(err);

        // Store hash in your password DB.
        resolve(hash);
      });
    });
  });
}
</code></pre>
<p><img src="https://assets.codepen.io/5594200/Screen+Shot+2023-02-15+at+9.54.23+PM.png" alt="signup"></p>
<blockquote>
<blockquote>
<p>If a user tries to sign up and the username entered already exists, then a user is sent a <strong>400</strong> error message.</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p><img src="https://assets.codepen.io/5594200/Screen+Shot+2023-02-16+at+7.02.32+AM.png" alt="signup"></p>
</blockquote>
</blockquote>
<hr>
<h1>Node <i class="fa-brands fa-node"></i></h1>
<pre><code class="javascript">require(&quot;uuid&quot;);
</code></pre>
<p>the uuid module is used to create UUIDs for session IDs.</p>
<pre><code class="javascript">require(&quot;cors&quot;);
</code></pre>
<p>the cors or the cross-origen module alows for post a get reqests to be cross-origen</p>
<pre><code class="javascript">require(&quot;express&quot;);
</code></pre>
<p>The express module does a ton, from using get/post requests to handling the HTTP server.</p>
<blockquote>
<blockquote>
<p><code>require(&quot;express-session&quot;)</code><br>
express-session is a module that alows a user to create sessions in express</p>
</blockquote>
</blockquote>
<pre><code class="javascript">require(&quot;http&quot;);
</code></pre>
<p>http in this project creates the http server. Express handles the reqests and sessions</p>
<pre><code class="javascript">require(&quot;path&quot;);
</code></pre>
<p>path allows for express to have /<strong>name</strong></p>
<pre><code class="javascript">require(&quot;socket.io&quot;);
</code></pre>
<p>socket are what allow for chats to work</p>
<pre><code class="javascript">require(&quot;bcrypt&quot;);
</code></pre>
<p>hides the passwords in the Database</p>
<pre><code class="javascript">require(&quot;sequelize&quot;);
</code></pre>
<p>sequelize is a huge module that allows coders to create sql requests easily</p>
<blockquote>
<blockquote>
<p><code>require(&quot;sqlite3&quot;)</code><br>
the sqlite3 is reqired to allow the sequelize module to work</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<h2>local install <i class="fa-thin fa-computer"></i></h2>
</blockquote>
</blockquote>
<pre><code class="bash">npm install uuid cors express express-session http path socket.io bcrypt sequelize
</code></pre>
<h1>sockets <i class="fa-duotone fa-message-lines"></i></h1>
<blockquote>
<blockquote>
<h2>client side <i class="fa-sharp fa-solid fa-person"></i></h2>
<ol>
<li>people
<ol>
<li>gets all of the active and inactive members on the site.</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="2">
<li>sent
<ol>
<li>gets wether or not a message was sent</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="3">
<li>message
<ol>
<li>logs the <strong>HTML</strong> message</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="4">
<li>persistence
<ol>
<li>gets all of the chat in that room</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="5">
<li>typping
<ol>
<li>gets if the user is typping</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="6">
<li>ntypping
<ol>
<li>gets if the user is done typping</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<h2>server side <i class="fa-solid fa-server"></i></h2>
<blockquote>
<blockquote>
<ol>
<li>error
<ol>
<li>dissconects the user from the sockets if the error is resolting in the user being unauthorized</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="2">
<li>logedin
<ol>
<li>validates the user on the serviside with sockets</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="3">
<li>logremove
<ol>
<li>gets if the user has removed there account and removes them completly from the member listing</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="4">
<li>logedout
<ol>
<li>gets if the user has logged out and changes there statatus to inactive</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="5">
<li>persistence
<ol>
<li>Returns the room code for users. If the users do not have a room code, they will create a room</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="6">
<li><code>socket.chat_room</code>
<ol>
<li>brodcasts that a message has been sent. This is sent to the room</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="7">
<li>typping
<ol>
<li>emits to the room that there is a member typing</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="8">
<li>ntypping
<ol>
<li>send back to the client if they are finnised typping</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<ol start="9">
<li>message
<ol>
<li>adds messages to the messages table</li>
</ol>
</li>
</ol>
</blockquote>
</blockquote>
<hr>
<h1>Diagrams <i class="fa-duotone fa-diagram-project"></i></h1>
<hr>
<blockquote>
<blockquote>
<h2>login page <i class="fa-solid fa-page"></i></h2>
</blockquote>
</blockquote>
<p>server --&gt; validate --&gt; if validate datatase &amp; home<br>
server --&gt; validate --&gt; if not validate redirected to sever</p>
<p>datatase --&gt; validate<br>
home --&gt; loading &amp; sockets</p>
<pre><code class="mermaid">---
title: Logging in
---

flowchart TD


    id1[server] --&gt; id2{validate}

id10[(Database)] --&gt;|sent| id2
id2 .-&gt;|recived| id10


    id2 --&gt;|yes| id3[home]

     id2 --&gt;|no| id4[fail]

    id3 ==&gt; id5[loading...]

    id3 ==&gt; id6[sockets]


    id4 ~~~ |redirected to sever| id1


note[validate pulls data from databace to log a user in]
note1[fail will foce a user to re-login]


note .-id2
note1 .-id4
</code></pre>
<hr>
<blockquote>
<blockquote>
<h2>signup page <i class="fa-solid fa-page"></i></h2>
</blockquote>
</blockquote>
<p>server --&gt; validate --&gt; if validate datatase &amp; home<br>
server --&gt; validate --&gt; if not validate redirected to sever</p>
<p>datatase --&gt; validate<br>
home --&gt; loading &amp; sockets</p>
<pre><code class="mermaid">---
title: Signing up
---

flowchart TD

    a[server]
    b{validate}
    c[home]
    Database[(Database)]
    e[redirect]

    a --&gt; b

    Database --&gt;|sent| b

    b --&gt;|yes| c
    b ---&gt;|no| e

    b ~~~|username and password are saved| b


    b .-&gt; Database

    e ~~~|sends the user back if \nthe username or password were invalid.| a
</code></pre>
<hr>
<blockquote>
<blockquote>
<h2>sockets page <i class="fa-solid fa-page"></i></h2>
<p>Server --&gt; People --&gt; Client</p>
</blockquote>
</blockquote>
<pre><code class="mermaid">---
title: a simple server to client socket ping for People
---
classDiagram

    Server --&gt; People : Sent
    Client &lt;-- People : Recived

    class Server{
       +sends to the user

    }
    class Client{
        +gets the message and handles it
    }
    class People {
 +reiceves the message
 +sends a message back
    }

</code></pre>
<hr>
<p>Client --&gt; typping or ntypping<br>
Server --&gt; gets typping and or ntypping</p>
<p>block is just to show that typping and ntypping are prossesd by the Server</p>
<pre><code class="mermaid">---
title: a simple server to client socket ping for typping and ntypping
---


classDiagram
    note for typping &quot;typping is sent when a user types&quot;

    note for ntypping &quot;ntypping is sent when a user is done typing&quot;

    note for Block &quot;typping and ntypping are not sent to a location but, are sent to Client&quot;

    Client --&gt; typping : Sent
    Client --&gt; ntypping : Sent

   typping --&gt; Server : Recived
   ntypping --&gt; Server : Recived




  Block --&gt; Client: Sent

  typping -- Block : sent to a non-fixed location
ntypping -- Block :sent to a non-fixed location

    class Server{
       +sends to the user

    }
    class Client{
        +gets the message and handles it
    }
    class typping {
 +reiceves the message
 +sends a message back
    }

    class ntypping {
 +reiceves the message
 +sends a message back
    }


    class Block {

    }
</code></pre>
<hr>
<p>Client --&gt; message --&gt; Server --&gt; Client and databace</p>
<pre><code class="mermaid">---
title: a simple server to client socket ping for message
---


classDiagram
direction RL


note for message &quot;messages sent go to the client then to the server and then back to the client&quot;

  Client --&gt; message :Sent

message --&gt; Server :Sent

    Client &lt;-- Server:recived


Server ..|&gt; databace :Conected, but sql is sent useing seqilise


    class Server{
       +sends to the user

    }
    class Client{
        +gets the message and handles it
    }
    class message {
 +reiceves the message
 +sends a message to the server
    }

    class databace {
 +reiceves the message
 +sends a message back
    }
</code></pre>
<hr>
<p>Client --&gt; persistance --&gt; Server --&gt; databace<br>
databace --&gt; Server --&gt; persistance --&gt; Client</p>
<pre><code class="mermaid">---
title: a simple server to client socket ping for persistance
---


classDiagram
note &quot;Client sends the persistance message when they need a chat box \n Messages are sent back form the Databace \n the client gets all of the nessages for the Databace&quot;

persistance &lt;-- Client : sent

persistance --&gt; Server: sent

Server ..|&gt; databace :Conected, but sql is sent useing seqilise

databace ..&gt; Server : sent
Server ..&gt; persistance: sent
persistance ..&gt; Client: recived


    class Server{
       +sends to the user

    }
    class Client{
        +gets the message and handles it
    }
    class persistance {
 +reiceves the message
 +sends a message to the server
    }

    class databace {
 +reiceves the message
 +sends a message back
    }
</code></pre>
<hr>
<p>Server --&gt; error --&gt; off<br>
Client --&gt; error --&gt; end</p>
<pre><code class="mermaid">---
title: a simple server to client socket ping for persistance
---


classDiagram
direction LR


note for end &quot;there was something wrong on the server side so the code will end \n on end the sockets turn off \n this is nvere enacted&quot;
Server --&gt; error:sent
error --|&gt; end

note for off &quot;there was something wrong on the client side so the sockets will turn off&quot;


Client --&gt; error:sent
error --|&gt; off



    class Server{
    +sends to the user

    }
    class Client{
        +gets the message and handles it
    }
    class error {
 +reiceves the message
    }
</code></pre>
<hr>
<blockquote>
<blockquote>
<blockquote>
<h2>Update Username <i class="fa-duotone fa-users"></i></h2>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="mermaid">---
title: Re-nameing username
---

flowchart TD

note[Re-nameing an account validates the username to make sure \n there are are not any duplicates \n in the case of a fail in any step the page will just continue with out renameing] ~~~ databace

a[server]
b[client]
c[[renameing]]
d{valid}
e[reload]
databace[(databace)]

b --&gt;|sent| a


a ---|check| d

c ..-&gt;|check| d

d --&gt;|yes| c

d --&gt;|no| e

databace &lt;.-&gt; |sent \n recived| d
</code></pre>
<hr>
<blockquote>
<blockquote>
<blockquote>
<h2>Update Password <i class="fa-duotone fa-user-ninja"></i></h2>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="mermaid">---
title: Re-nameing password
---

flowchart TD

note[Re-nameing an password changes it\n there are are not any duplicates \n in the case of a fail in any step the page will just continue with out renameing] ~~~ databace

note2[the databace changes the password and is \nasked to validate the old one] ~~~ databace
a[server]
b[client]
c[[renameing]]
d{valid}
e[reload]
databace[(databace)]

b --&gt;|sent| a


a ---|check| d

c ..-&gt;|sent| databace

d --&gt;|yes| c

d --&gt;|no| e

 databace.-&gt; |sent| d
</code></pre>
<hr>
<blockquote>
<blockquote>
<blockquote>
<h2>deleting account <i class="fa-solid fa-trash"></i></h2>
</blockquote>
</blockquote>
</blockquote>
<pre><code class="mermaid">---
title: deleting account
---

flowchart TD

note[the users account is validated before it can be removed] ~~~ databace1
note1[when a user is removed \n there account is soft-deleted] ~~~ databace

note2[home is the main page where you do chatting] ~~~ f
note3[login where you go to create a account or login] ~~~ e

a[server]
b[client]
c[[deleting]]
d{valid}
e[login]
f[home]

databace[(databace)]
databace1[(databace)]


b --&gt;|check| d

d --&gt;|yes| a

d --&gt;|no| f


b ~~~ a

a --&gt; c


databace1 --&gt; d

c --&gt;|removes all mention of you| databace
c --&gt; e
</code></pre>
<hr>
<h1>html assets <i class="fa-solid fa-files"></i></h1>
<p>bootstrap is a html madule that can be imported. The modules have both .js and .css vareients to use. bootstrap allows for a user to create styling for diffrent html things. bootstrap is used to create the buttons in the [account page] and the popups in the [home page]. bootstrap 5 handdles the stying of the buttons buttons</p>
<p>bootstrap 3 handels the styling of the popups while jquery, notify and mouse0270 handle the script behind the popups.</p>
<p>mouse0270 is a add on to bootstrap 3 and hanndles window animations for popups<br>
animate is used to add animations to css and is used for bootstrap popups as a bootstrap add on</p>
<p>jquery is an epic <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model/Introduction">DOM</a> coding resorce. It allows defelepers to write <code>$</code> insted of <code>document.nodeFinder</code>. jquery also uses ajax witch allows for a user to create <code>xmlhttprequest</code>. jquery also includes a whole libray of functions to simplify DOM.</p>
<p>socket.io is used to create <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket">web sockets</a> for a user.<br>
Socket.io is a simple libray that allows for a user to use websockets. Socket.io contains a http library as well as a websockets. Socket.io is used in both the client and server side.</p>
<p>This client side of socket.io handles what the use will see.<br>
the server side handels what is sent to the client, what a user will see, and wether or no sockes should be connected. the server side also uses sessions to handle user information.</p>
<p>fontawesome is a free icon library. The libray allows a use to use the <code>&lt;i class='icon'&gt;&lt;/&gt;</code> to create butifull icons. each icon is a svg path.</p>
<p>swal is a library that uses javascript and css to create popups. swal is used in the iframe to inform the user of the next step.</p>
<p>w3schools is a coding reposotorry, and is a how to for coders. I used the css for</p>
<p>confetti allows a user to have confetti in the canvas. confetti is used in the Home tab canvas.</p>
<h2>iframe page <i class="fa-solid fa-page"></i></h2>
<table>
<thead>
<tr>
<th>css</th>
<th>js</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td><a href="https://kit.fontawesome.com/fd76b8450f.js">fontawesome pro</a></td>
</tr>
<tr>
<td></td>
<td><a href="https://cdn.jsdelivr.net/npm/sweetalert2@11">swal 2</a></td>
</tr>
</tbody>
</table>
<h2>account page <i class="fa-solid fa-page"></i></h2>
<table>
<thead>
<tr>
<th>css</th>
<th>html</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css">bootstrap 5 v5.2.1</a></td>
<td><a href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js">bootstrap 5 v5.2.1</a></td>
</tr>
</tbody>
</table>
<h2>home page <i class="fa-solid fa-page"></i></h2>
<table>
<thead>
<tr>
<th>css</th>
<th>js</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.3/animate.min.css">animate 3.2.3</a></td>
<td><a href="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js">crypto 3.1.2</a></td>
</tr>
<tr>
<td><a href="https://www.w3schools.com/w3css/4/w3.css">w3schools</a></td>
<td><a href="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js">jquery 3.6.0</a></td>
</tr>
<tr>
<td><a href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css">bootstrap 5 v5.2.1</a></td>
<td><a href="/socket.io/socket.io.js">socket.io</a></td>
</tr>
<tr>
<td></td>
<td><a href="https://cdnjs.cloudflare.com/ajax/libs/mouse0270-bootstrap-notify/3.1.5/bootstrap-notify.min.js">bootstrap 3 v/3.1.5</a></td>
</tr>
<tr>
<td></td>
<td><a href="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js">marked 0.3.2</a></td>
</tr>
<tr>
<td></td>
<td><a href="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js">confetti latest</a></td>
</tr>
</tbody>
</table>


          <!-- partial -->
          <script type="module" src="/markdown/script.js"></script>
        </body>
      </html>
    </main>

    <main class="Settings">
      <h3 style="text-align: center">change user name</h3>

      <label for="username">Your password</label>
      <input type="text" class="password changeP" required />
      <br />
      <label for="N-username">new username</label>
      <input type="text" class="N-username" required disabled />
      <br />
      <input type="submit" id="submit" value="check my account" />

      <hr />

      <h3 style="text-align: center">change password</h3>

      <label for="username">Your password</label>
      <input type="text" class="password changePP" required />
      <br />
      <label for="N-username">new password</label>
      <input type="text" class="N-password" required disabled />
      <br />
      <input type="submit" id="submit1" value="check my account" />

      <hr />

      <h3 style="text-align: center">Delete your account</h3>

      <label for="username">Your password</label>
      <input type="text" class="password deleteP" required />
      <br />
      <input type="submit" id="submitD" value="delet my account" />
    </main>

    <script
      src="https://kit.fontawesome.com/fd76b8450f.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mouse0270-bootstrap-notify/3.1.5/bootstrap-notify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
    <script src="/js/welcolm.js"></script>
    <script src="/js/socket.js"></script>

    <script>
      document.querySelectorAll("main").forEach((item) => {
        item.style.display = "none";
      });

      let p = sessionStorage.getItem("tab") || "Home";
      /*
document.querySelector(p).click();
document.querySelector(p).classList.replace("inactive", "active");
*/

      document.querySelector("." + p).style.display = "block";

      document.querySelectorAll(".itm").forEach((item) => {
        if (item.textContent.trim() == p) {
          item.classList.replace("inactive", "active");

          switch (item.textContent.trim()) {
            case "Information":
              break;
            case "Chats":
              break;
            case "Home":
              break;
            case "How to":
              break;
            case "Settings":
              break;
            default:
              break;
          }
        }
      });

      welcolm(username);
      chatWelcolm(username);

      //
      var o = ["Question", "Home", "Chat", "Information", "Settings"];

      document.querySelectorAll(".itm").forEach((item) => {
        item.addEventListener("click", function () {
          let clicked = this.innerText.trim();

          document.querySelectorAll(".itm").forEach(function (x) {
            if (x.innerText.trim() == clicked) {
              x.classList.replace("inactive", "active");
            } else {
              x.classList.replace("active", "inactive");
            }
          });

          document.querySelectorAll("main").forEach((item) => {
            if (item.className == this.innerText.trim()) {
              item.style.display = "block";
            } else {
              item.style.display = "none";
            }
          });

          sessionStorage.setItem("tab", this.innerText.trim());

          switch (this.innerText.trim()) {
            case "Information":
              break;
            case "Chats":
              break;
            case "Home":
              break;
            case "How to":
              break;
            case "Settings":
              break;
            default:
              break;
          }
        });
      });
    </script>

    <script>
      //alert(window.location)

      async function removeAccount(event) {
        event.preventDefault();

        let v = await validate(deleteU.value, deleteP.value);

        if (v.valid === false && v.valid !== undefined) {
          alert("Please enter a valid password");
        } else {
          let e = window.prompt(
            "are you sure you want to delete this account? this is a permanant action. Type Delete to complete this action!"
          );

          if (e.trim() == "Delete") {
            socket.emit("logremove", username);

            deleteAccount(deleteU.value, deleteP.value).then(function (e) {
              if (e.res) {
                //  updateUsername(deleteU.value, deleteP.value, 'delete').then(function(e){
                document.querySelectorAll("#home")[0].click();
                //  })
              } else {
                alert("there was a problem deleting this account");
              }
            });
          }
        }
      }

      // delets an account
      function deleteAccount(username, password) {
        return new Promise((resolve, reject) => {
          $.ajax({
            type: "post",
            url: "http://localhost:3000/api/account/remove",
            data: {
              username: username,
              password: password,
            },
            success: function (e) {
              resolve(e);
            },
          });
        });
      }

      //gets if the account is valid
      function validate(username, password) {
        return new Promise((resolve, reject) => {
          $.ajax({
            type: "post",
            url: "http://localhost:3000/api/account/validate",
            data: {
              username: username,
              password: password,
            },
            success: function (e) {
              resolve(e);
            },
          });
        });
      }

      //resets a username
      function updateUsername(username, password, new_username) {
        return new Promise((resolve, reject) => {
          $.ajax({
            type: "post",
            url: "http://localhost:3000/api/account/changeUsername",
            data: {
              curr_username: username,
              curr_password: password,
              new_username: new_username,
            },
            success: function (e) {
              resolve(e);
            },
          });
        });
      }

      //resets password
      function updatePassword(username, password, new_password) {
        return new Promise((resolve, reject) => {
          $.ajax({
            type: "post",
            url: "http://localhost:3000/api/account/changePassword",
            data: {
              curr_username: username,
              curr_password: password,
              new_password: new_password,
            },
            success: function (e) {
              resolve(e);
            },
          });
        });
      }

      // resets the change username form
      function reset() {
        usernameC.value = username;
        passwordC.value = "";

        N_username.setAttribute("disabled", true);
        passwordC.removeAttribute("disabled");

        submit.addEventListener("click", update);
      }

      // resets the change password for,
      function resetA() {
        usernameP.value = username;
        passwordP.value = "";

        N_password.setAttribute("disabled", true);
        passwordP.removeAttribute("disabled");

        submit1.addEventListener("click", resetA);
      }
      // the event for updating password
      async function updateA(e) {
        if (N_password.value.trim().length > 0) {
          if (!(passwordP.value == N_password.value)) {
            let a = window.confirm(
              "are you sure you want to reset your password"
            );

            if (a) {
              updatePassword(usernameP.value, passwordP.value, N_password.value)
                .then(function () {
                  alert("your account is updated");
                })
                .then(function () {
                  resetA();
                  window.location.reload();
                });
            }
          } else {
          }
        }
      }
      // the event for updating userna,e
      async function update(e) {
        if (N_username.value.trim().length > 0) {
          let v = await validate(N_username.value, passwordC.value);

          if (!v.valid && !(usernameC.value == N_username.value)) {
            updateUsername(usernameC.value, passwordC.value, N_username.value)
              .then(function () {
                alert("your account is updated");
              })
              .then(function () {
                reset();

                socket.emit("logedin", N_username.value);
                socket.username = N_username.value;
                window.location.reload();
              });
          } else {
            v.valid
              ? alert(
                  "Please enter a new valid username that dose not already exist"
                )
              : usernameC.value == N_username.value
              ? alert("please enter a new username")
              : null;
          }
        }
      }
      // a function to help with the changing of username
      async function valUpdate(e) {
        e.preventDefault();
        let v = await validate(usernameC.value, passwordC.value);

        if (v.valid === true && v.valid !== undefined) {
          N_username.removeAttribute("disabled");
          submit.value = "submit";
          passwordC.setAttribute("disabled", true);

          submit.removeEventListener("click", valUpdate);
          submit.addEventListener("click", update);
        }
      }
      // a function to help with the changing of passwords
      async function pwdUpdate(e) {
        e.preventDefault();

        if (passwordP.value.trim().length > 0) {
          let v = await validate(usernameP.value, passwordP.value);

          N_password.removeAttribute("disabled");
          submit1.value = "submit";
          passwordP.setAttribute("disabled", true);

          submit1.removeEventListener("click", pwdUpdate);

          submit1.addEventListener("click", updateA);
        }
      }

      // delete yor account

      let deleteU = { value: socket.username };
      const deleteP = document.querySelector(".deleteP");
      const button = document.querySelector("#submitD");

      deleteU.value = username;

      button.addEventListener("click", removeAccount);

      //update you username
      const usernameC = deleteU;
      const passwordC = document.querySelector(".changeP");
      const N_username = document.querySelector(".N-username");

      const submit = document.querySelector("#submit");

      submit.addEventListener("click", valUpdate);

      //update password

      const usernameP = deleteU;
      const passwordP = document.querySelector(".changePP");
      const N_password = document.querySelector(".N-password");

      const submit1 = document.querySelector("#submit1");

      submit1.addEventListener("click", pwdUpdate);
    </script>

    <script>
      //https://dev.to/eaich/how-to-detect-when-the-user-stops-typing-3cm1

      let timer,
        timeoutVal = 3000; // time it takes to wait for user to stop typing in ms

      // detects when the user is actively typing
      test.addEventListener("keypress", handleKeyPress);
      // triggers a check to see if the user is actually done typing
      test.addEventListener("keyup", handleKeyUp);

      // when the user has stopped pressing on keys, set the timeout
      // if the user presses on keys before the timeout is reached, then this timeout should be canceled via the keypress event
      function handleKeyUp(e) {
        window.clearTimeout(timer); // prevent errant multiple timeouts from being generated
        timer = window.setTimeout(() => {
          socket.emit("ntypping", socket.array);
        }, timeoutVal);
      }

      // when user is pressing down on keys, clear the timeout
      // a keyup event always follows a keypress event so the timeout will be re-initiated there
      function handleKeyPress(e) {
        window.clearTimeout(timer);
        socket.emit("typping", socket.array);
      }
    </script>
  </body>
</html>