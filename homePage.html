<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>My Website</title>
		<link rel="icon" href="./favicon.ico" type="image/x-icon">
		<style>
			:focus {
			outline: none;
			box-shadow: none!important;
			}
			.overlay {
			height: 100%;
			width: 100%;
			display: none;
			position: fixed;
			z-index: 1;
			top: 0;
			left: 0;
			background-color: rgb(0,0,0);
			background-color: rgba(0,0,0, 0.9);
			}
			.overlay-content {
			position: relative;
			top: 25%;
			width: 100%;
			text-align: center;
			margin-top: 30px;
			}
			.overlay a {
			padding: 8px;
			text-decoration: none;
			font-size: 36px;
			color: #818181;
			display: block;
			transition: 0.3s;
			}
			.overlay a:hover, .overlay a:focus {
			color: #f1f1f1;
			}
			ul {
			list-style-type: none;
			width: 200px;
			height: 550px;
			background-color: lightgray;
			}
			li {
			font: 1rem 'Fira Sans', sans-serif;
			}
			.messageBar {
			width: 240px;
			height: 24px;
			border: solid black 1px;
			border-radius: 40px;
			}
			table, td, th {
			border: 0px solid;
			}
			table {
			width: 400px;
			border-collapse: collapse;
			}
			@media only screen and (max-height: 540px) {
			ul {
			height: 450px;
			}
			}
			@media only screen and (max-height: 440px) {
			ul {
			height: 350px;
			}
			}
			@media only screen and (max-height: 340px) {
			ul {
			height: 250px;
			}
			}
			@media only screen and (max-height: 240px) {
			.overlay {
			display: block;
			}
			}
			.flex-container {
			display: grid;
			grid-template-columns: 1fr 1fr;
			grid-gap: 20px;
			}
			
			

.active {
    background-color: #00E676;
}

.inactive {
    background-color: #FF1744;
}





.chip{
    display: inline-flex;
    flex-direction: row;
    background-color: #e5e5e5;
    border: none;
    cursor: default;
    height: 36px;
    outline: none;
    padding: 0;
    font-size: 14px;
    font-color: #333333;
    font-family:"Open Sans", sans-serif;
    white-space: nowrap;
    align-items: center;
    border-radius: 16px;
    vertical-align: middle;
    text-decoration: none;
    justify-content: center;
}
.chip-head{
    display: flex;
    position: relative;
    overflow: hidden;
    font-size: 1.25rem;
    flex-shrink: 0;
    align-items: center;
    user-select: none;
    border-radius: 50%;
    justify-content: center;
    width: 36px;
    color: #fff;
    height: 36px;
    font-size: 20px;
    margin-right: -4px;
}
.chip-content{
    cursor: inherit;
    display: flex;
    align-items: center;
    user-select: none;
    white-space: nowrap;
    padding-left: 12px;
    padding-right: 12px;
}
.chip-svg{
        color: #999999;
    cursor: pointer;
    height: auto;
    margin: 4px 4px 0 -8px;
  fill: currentColor;
    width: 1em;
    height: 1em;
    display: inline-block;
    font-size: 24px;
    transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
    user-select: none;
    flex-shrink: 0;
}
.chip-svg:hover{
    color: #666666;
}









.tooltip {
  position: relative;
  display: inline-block;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;

  /* Position the tooltip */
  position: absolute;
  z-index: 1;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}
		</style>
	</head>
	<body>
		<main>
			<div id="myNav" class="overlay">
				<div class="overlay-content">
					<a href="#">Page is too small</a>
				</div>
			</div>
			<h1>Welcome to My Website</h1>
			<div class='bar'>
				<form id='home' action='/logout' method="post">
					<i class="fa-solid fa-house"></i>
					<a>Log out</a>
				</form>
			</div>
			<div class="flex-container">
				<div class="inputs">
					<ul class='chat'></ul>
					<input class="messageBar"></input>
				</div>
				<div class="table">
					<table>
					</table>
				</div>
			</div>
		</main>
		<script
    src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.2/qs.min.js"
    integrity="sha256-TDxXjkAUay70ae/QJBEpGKkpVslXaHHayklIVglFRT4="
    crossorigin="anonymous"
  ></script>

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<script src="https://kit.fontawesome.com/fd76b8450f.js" crossorigin="anonymous"></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js'></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>

<script>
class Pils{
    constructor(id){
        this.id = id
        this.chip = document.createElement('div')
    this.chip.setAttribute('class','chip')
    
    this.tooltip = document.createElement('div')
     this.tooltip.setAttribute('class','tooltip')
     
     this.chip_head =  document.createElement('div')
      this.chip_head.id = 'chip_head '+this.id
     
     this.tooltiptext =  document.createElement('span')
     this.tooltiptext.setAttribute('class',`tooltiptext`)
     this.tooltiptext.id = 'tooltiptext '+this.id
     
      this.chip_content = document.createElement('div')
     this.chip_content.setAttribute('class','chip-content')
     
     this.chip_close = document.createElement('div')
     this.chip_close.setAttribute('class','chip-close')
     
     this.chip_close.innerHTML = `<svg onclick="this.parentElement.parentElement.style.display='none'" class="chip-svg" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path></svg>`
     //onclick="this.parentElement.style.display='none'"
    }
    
     create_pil(stus,username,t=true){
     this.chip_head.setAttribute('class',`chip-head ${stus}`)
     
     this.tooltiptext.innerText = stus
     
     
     this.tooltip.append(this.chip_head,this.tooltiptext)
     
     this.chip_content.innerText = username

     this.chip.append(this.tooltip, this.chip_content, this.chip_close)
     
     this.chip.id = this.id
     
     if(t){
     document.querySelector('body').append(this.chip)
     }else{
         return this.chip 
     }
}

change_pil(stus){
   //   this.className = ""
    this.chip_head.classList.add('chip-head')
    this.chip_head.classList.add(stus)
    
    this.tooltiptext.innerText = stus
}

change_pilFrom(element, stus){
   // element.className = ''
    let chip_head = document.getElementById('chip_head '+this.id)
    let tooltiptext = document.getElementById('tooltiptext '+this.id)
    //tooltiptext
    chip_head.classList.add('chip-head')
    chip_head.classList.add(stus)
    
    tooltiptext.innerText = stus
}

}

	
var xhr = new XMLHttpRequest();
xhr.open('GET', document.location, false);
xhr.send(null);
//.getAllResponseHeaders().toLowerCase();


var socket = io();
	/*
var username;
if( localStorage.getItem('username') ){
    username =  localStorage.getItem('username')
}else{
    username = xhr.getResponseHeader("user"); //prompt('what is your username')
}

localStorage.setItem('username', username);
*/

	    username = xhr.getResponseHeader("user"); //prompt('what is your username')

socket.emit('logedin',username)

//var to = prompt('who would you like to chat with')


function message(m) {
			 				  let li = document.createElement('li')
			
			     let txt = document.createTextNode( m )
			
			li.append( txt )
			 chats.append( li )
			 
			 input.value = ""
		
			return;
			}

function add_row(room,id,active){
			var tr = document.createElement('tr')
			
			tr.id = room

			let pill = new Pils(id)
			let pil;
/*			
if (typeof(element) != 'undefined' && element != null)
{
  // Exists.
  let s = active  ? 'active' : 'inactive'
  
  
  pill.change_pilFrom(document.getElementById(id),s)
  

}else{
*/
    		let s = active  ? 'active' : 'inactive'
			
			 pil = pill.create_pil(s,room,false)
			
			pil.addEventListener('click',function(){
			    roomThing(room)
			    })
		
					tdb = document.createElement('td')
			tdb.append(pil)
			
			tr.append(tdb)

			document.querySelector('table').append(tr)
			
			  pill.change_pilFrom(document.getElementById(id),s)

//}

			}
			
function roomThing(room) {
		let to = room
		
socket.emit('room', [username,to] )

socket.emit('persistence', [to,username] )

			}
	
// Get the input field
var input = document.querySelector(".messageBar");
var chats = document.querySelector(".chat")
var home = document.querySelector('#home')			
// Execute a function when the user presses a key on the keyboard
input.addEventListener("keypress", function(event) {
    // If the user presses the "Enter" key on the keyboard
    if (event.key === "Enter") {
        // Cancel the default action, if needed
        event.preventDefault();
        				
        socket.emit('message', username +":  "+input.value );
    }
});
	
home.addEventListener('click',function(event){
    socket.emit('logedin',username)

    document.querySelector('#home').submit()
})



socket.on('people', (arr) => {
    arr.map(function(x){
        if( username != x[0] ){
        add_row(x[0],socket.id,x[1])
        }
          
          
    })// pill.create_pil('active',usr) )
    socket.off('people')
})


socket.on('message', x => {
    message(x)
	})


socket.on('persistence', x => {
    chats.innerHTML = 'this is a message just for you'
	    x.map(a => message(a) )
	})

</script>


	</body>
</html>
