<script src="https://kit.fontawesome.com/fd76b8450f.js" crossorigin="anonymous"></script>
	    <script src="/socket.io/socket.io.js"></script>

<script src='https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script src="https://cdn.pubnub.com/pubnub.min.js"></script>



<body>
    <div class='bar'>
        	<form id='home' action='/home' method="get">
	    <i class="fa-solid fa-house" ></i>
		<a>Log out</a>  

		
	</form>


    </div>
 
 
 <div id="info">
<input id='Name'></input>
 <button id="setname" onclick="set_name(document.getElementById('Name').value )">Name</button>
</div>

<div id="all">
<br>
  <div id="inputs">
 <input id="login" readonly></input> 
<button id="host"  onclick="host()">host</button>
<br>
<input id="joins" required></input> 
<button id="join" onclick="join(document.getElementById('joins').value,true )" >join</button>
</div>

  <p class="presence"></p>


<div id="users">
</div>

<lable for'box' id='boxTXT'>Chat Output</lable>
<div id="box" ></div>


Enter Chat and press enter
<div><input id="input" placeholder="type message here" /></div>
</div>



</body>





<script>
	const home = document.getElementById('home')

	home.addEventListener('click',function(params) {
		home.submit()
	})
	
	
function generatePass(pLength){
        charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",
        retVal = "";
    for (var i = 0, n = charset.length; i < pLength; ++i) {
        retVal += charset.charAt(Math.floor(Math.random() * n));
    }
    return retVal;
  
}

</script>


<script>
const time_out_time = 100000

window.addEventListener('click',reset_time_out);
window.addEventListener('mousemove',reset_time_out);
window.addEventListener('keydown',reset_time_out);
//window.addEventListener('click',reset_time_out);
setTimeout(function(){
    if(document.getElementById('Name').value == ''){
        time_out()
    }

},3000)
// times out after 100 seconds
var myTimeout = setTimeout(time_out, time_out_time);

function time_out() {
sessionStorage.removeItem("passwordIn");

 home.click()
}

function reset_time_out(){
      clearTimeout(myTimeout);
       myTimeout = setTimeout(time_out, time_out_time)
}
</script>


<style>
@import "https://fonts.googleapis.com/icon?family=Material+Icons";


body {
  font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
}

#box {
  border: 2px solid #efefef;
  width: 700px;
  height: 80%;
  overflow-y: auto;
  margin-bottom: 20px;
  
  position: absolute;
  
  top: 40px;
  left: 400px; 
}

.avatar {
	width: 80px;
	height: 80px;
  border-radius: 40px; /* половина ширины и высоты */
  margin: 10px;
}

#input {
  position: absolute;
 
  top: 20px;
  left: 400px;
  
}

#boxTXT {
  position: absolute;
  
  top: 0;
  
  left: 400px;
}

input {
  width: 300px;
}

button {
  width: 70px;
}


* {
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
}
</style>

<script type = "text/javascript">

var socket = io();

//socket.emit('create', 'room1');

// this will ask the client who they are 
socket.on('whoAreyou', function(msg) {

$('#Name').val(msg)
$('#setname').click()

try{
console.log( msg )
}catch(e){
console.log('the chat will not work until you login')
}

			  socket.off('whoAreyou');
		  })


</script>

<script type = "text/javascript">
var names,
presence = document.querySelector('.presence');

$("#all").hide()

$("#setname").click(function(){
  if( $("#Name").val().trim().length == 0 ){
 
  }else{
    $("#info").hide('slow',function(){
      $("#info").hide()
    })
    $("#all").show()

  }
})



set_name = function(a){
   names = a
}


function host(){
           socket.removeAllListeners( $("#login").val() )


    if($("#login").val() != '' && $('#joins').val() != ''){
        $('#joins').val('')
    }
    
            $("#login").val('')
        

  $("#login").val(generatePass(9) )


  join(  $("#login").val(),false )
     



}

// Get the input field
var input = $("#input");


function join(e,first){
if( first ){
     if($("#login").val() != '' && $('#joins').val() != ''){
        $('#login').val('')
    } 
}
  socket.emit('room name',e)

// Execute a function when the user presses a key on the keyboard
input.on("keypress", function(event) {
  // If the user presses the "Enter" key on the keyboard
  if (event.key === "Enter") {
    // Cancel the default action, if needed
    event.preventDefault();
    // Trigger the button element with a click
    var is = e == $("#login").val() ^ e == $('#joins').val()
    if( is != 1 ) return; 
     socket.emit('chat message',event.target.value ,e)
  }
});



socket.on(e, function(text){
    if( text.split(' :')[0] !=  e ) return
    if( box.innerHTML == ''){
         box.innerHTML =  (''+text).replace( /[<>]/g, '' ) 
    }else{
         box.innerHTML = box.innerHTML + "<br>"+ (''+text).replace( /[<>]/g, '' ) 
    }
  input.val('')
})

/*  
(function(){
  
  var 
  box = PUBNUB.$('box'), 
  input = PUBNUB.$('input'), 
  channel = e
  
    PUBNUB.subscribe({
    channel: channel,
   callback : function(text) {
    box.innerHTML = box.innerHTML + "<br>"+ (''+text).replace( /[<>]/g, '' ) 
  },
    presence: function(text) {
      console.log(text)
        if (text.occupancy > 0) {
        presence.textContent = text.occupancy + ' people online';
      } else {
        presence.textContent = 'Nobody else is online';
      }
    
    }
  });

PUBNUB.bind('keyup', input, function(e) {
    
    var a = names+": "+ input.value;
  
  if(input.value === ''){
    
  }else{
  (e.keyCode || e.charCode) === 13 &&   PUBNUB.publish({
    channel : channel, message : a, x : (input.value='')
  })
  }
})


})()
*/  
  
    
}

    </script>
    
